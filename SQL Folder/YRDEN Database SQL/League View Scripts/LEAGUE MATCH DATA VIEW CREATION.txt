DROP VIEW "yrden".league_match_data;

CREATE OR REPLACE VIEW "yrden".LEAGUE_MATCH_DATA AS
SELECT LGD.RIOT_PUUID, YP.PERSON_ID,
LGD.RIOT_ID,
LGD.GAME_PATCH,
LGD.GAME_ID,
LGD.GAME_MODE,
LGD.QUEUE_ID,
LQV.DESCRIPTION,
LGD.CHAMPION_NAME,
LGD.CHAMPION_ID,
LGD.LANE,
CASE WHEN LGD.TEAMID = 100 THEN 'Blue' WHEN LGD.TEAMID = 200 THEN 'Red' ELSE NULL END as MAP_SIDE,
LGD.WIN,
LGD.KILLS,
LGD.DEATHS,
LGD.ASSISTS,
CASE WHEN LGD.DEATHS = 0 THEN (LGD.KILLS + LGD.ASSISTS) ELSE (LGD.KILLS + LGD.ASSISTS)/ LGD.DEATHS END AS KDA,
LGD.DOUBLE_KILLS,
LGD.TRIPLE_KILLS,
LGD.QUADRA_KILLS,
LGD.PENTA_KILLS,
LGD.GOLD_EARNED,
LGD.CHAMPION_DAMAGE,
LGD.OBJECTIVE_DAMAGE,
LGD.DAMAGE_HEALED,
LGD.VISION_SCORE,
LGD.MINIONS_KILLED,
LGD.NEUTRAL_MONSTERS_KILLED,
LGD.CONTROL_WARDS_PURCHASED,
LGD.KEYSTONE_RUNE_CODE,
KSV.RUNE_NAME as Keystone_Rune_Name,
LGD.KEYSTONE_RUNE_VAR1,
LGD.KEYSTONE_RUNE_VAR2,
LGD.KEYSTONE_RUNE_VAR3,
LGD.PRIMARY_RUNE_CODE1,
PRV1.RUNE_NAME as Primary_Rune1_Name,
LGD.PRIMARY_RUNE1_VAR1,
LGD.PRIMARY_RUNE1_VAR2,
LGD.PRIMARY_RUNE1_VAR3,
LGD.PRIMARY_RUNE_CODE2,
PRV2.RUNE_NAME as Primary_Rune2_Name,
LGD.PRIMARY_RUNE2_VAR1,
LGD.PRIMARY_RUNE2_VAR2,
LGD.PRIMARY_RUNE2_VAR3,
LGD.PRIMARY_RUNE_CODE3,
PRV3.RUNE_NAME as Primary_Rune3_Name,
LGD.PRIMARY_RUNE3_VAR1,
LGD.PRIMARY_RUNE3_VAR2,
LGD.PRIMARY_RUNE3_VAR3,
LGD.SECONDARY_RUNE_CODE1,
SRV1.RUNE_NAME as Secondary_Rune1_Name,
LGD.SECONDARY_RUNE1_VAR1,
LGD.SECONDARY_RUNE1_VAR2,
LGD.SECONDARY_RUNE1_VAR3,
LGD.SECONDARY_RUNE_CODE2,
SRV2.RUNE_NAME as Secondary_Rune2_Name,
LGD.SECONDARY_RUNE2_VAR1,
LGD.SECONDARY_RUNE2_VAR2,
LGD.SECONDARY_RUNE2_VAR3,
LGD.LARGEST_CRITICAL_STRIKE,
LGD.NEXUS_KILLS,
LGD.SUMMONER1_CASTS,
LGD.SUMMONER1_ID,
LSV1.SPELL_NAME summonerspell_1,
LGD.SUMMONER2_CASTS,
LGD.SUMMONER2_ID,
LSV2.SPELL_NAME summonerspell_2,
LGD.GAME_DURATION,
LGD.WARDS_KILLED,
LGD.WARDS_PLACED

FROM
"yrden".LOL_GAME_DATA LGD
inner JOIN "yrden".PEOPLE YP
ON LGD.RIOT_PUUID = YP.RIOT_PUUID
AND LGD.RIOT_ID = YP.RIOT_ID
LEFT JOIN "lollov".LOL_SUMMONER_SPELLS LSV1
ON LGD.SUMMONER1_ID = LSV1.SPELL_ID
LEFT JOIN "lollov".LOL_SUMMONER_SPELLS LSV2
ON LGD.SUMMONER2_ID = LSV2.SPELL_ID
LEFT JOIN "lollov".LOL_QUEUES LQV
ON LGD.QUEUE_ID = LQV.QUEUEID
left JOIN "lollov".LOL_RUNES KSV
ON LGD.KEYSTONE_RUNE_CODE = KSV.RUNE_ID
and substring(LGD.GAME_PATCH,2) = substring(KSV.PATCH_ID, 2)
LEFT JOIN "lollov".LOL_RUNES PRV1
ON LGD.primary_rune_code1 = PRV1.RUNE_ID
and substring(LGD.GAME_PATCH,2) = substring(PRV1.PATCH_ID, 2)
LEFT JOIN "lollov".LOL_RUNES PRV2
ON LGD.primary_rune_code2 = PRV2.RUNE_ID
and substring(LGD.GAME_PATCH,2) = substring(PRV2.PATCH_ID, 2)
LEFT JOIN "lollov".LOL_RUNES PRV3
ON LGD.primary_rune_code3 = PRV3.RUNE_ID
and substring(LGD.GAME_PATCH,2) = substring(PRV3.PATCH_ID, 2)
LEFT JOIN "lollov".LOL_RUNES SRV1
ON LGD.secondary_rune_code1 = SRV1.RUNE_ID
and substring(LGD.GAME_PATCH,2) = substring(SRV1.PATCH_ID, 2)
LEFT JOIN "lollov".LOL_RUNES SRV2
ON LGD.secondary_rune_code2 = SRV2.RUNE_ID
and substring(LGD.GAME_PATCH,2) = substring(SRV2.PATCH_ID, 2)
;
